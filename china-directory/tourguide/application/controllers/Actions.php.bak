<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Actions extends CI_Controller {
	
	public function __construct(){
		parent::__construct();
		$this->load->model('modelaction', '',TRUE);
		$this->load->view('addbusiness', '',TRUE);
	}
	public function Create(){
		if(!empty($_POST)){
		$insert = array(
			'business_name'					=> $this->input->post('business_name'),
			'business_owner'				=> $this->input->post('business_owner'),
			'business_latitude'				=> $this->input->post('business_latitude'),
			'business_longitude'			=> $this->input->post('business_longitude'),
			'business_address'				=> $this->input->post('business_address'),
			'business_category'				=> $this->input->post('business_category'),
			'business_status'				=> $this->input->post('business_status'),
			'business_image'				=> $this->input->post('business_image') ,
			'publish_date'					=> $this->input->post('publish_date'),
			'street_number'					=> $this->input->post('street_number'),
			'route'							=> $this->input->post('route'),
			'locality'						=> $this->input->post('locality'),
			'administrative_area_level_1'   => $this->input->post('administrative_area_level_1'),
			'postal_code'					=> $this->input->post('postal_code'),
			'country'						=> $this->input->post('country'),
			'dslat'							=> $this->input->post('dslat'),
			'dslong'						=> $this->input->post('dslong')
			);
			$this->modelaction->createQuery($insert);
			redirect(base_url() . '/welcome/businesslist');
		}
		else{
			 redirect(base_url());		
			}
	}
	public function Delete($business_id){
		$this->modelaction->deleteQuery($business_id);
		 
		 redirect(base_url() . 'welcome/businesslist');
	}
	public function Update($business_id){
		
	}
	
	public function Deactivate($business_id){
		$data = array(
		'business_status' 	=> '0'
		);
		$this->modelaction->deactivateQuery($business_id);
		redirect(base_url() . 'welcome/businesslist');
	}
	
		$data2 = array();
		$userData  								= $this->session->userdata('logged_in');
	

		$data['userID'] 						= $userID; 
		//$data2['userID'] 						= $userData['id'];
		$result 								= $this->BusinessList->records();	
		$activeAcount							= $this->BusinessList->useraccount($userID);
		
		$data['userRole'] 						= @$userData['Role'];
		$data['active_account']					= $activeAcount;
		$data['list_of_records'] 				= $result;
		$data['total'] 							= 0;
		$displayEvent							= $this->events->displayEventArray();
		$data['getRecordsDisplay']				= $this->BusinessList->getRecordsDisplay(NULL);
		$data['displayEvent']					= $displayEvent;
		
		$data['reactions'] = $this->events->countInterested();
		foreach($activeAcount as $row){
			//if($row->MentorUsername == $username){
			$data['LeaderName'] =  $row->first_name . ' ' . $row->maiden_name . ' ' .  $row->last_name ;
			//}
		}
		$userData  	= $this->session->userdata('logged_in');
		//$data['getRole'] 	= $this->users->getrole($userData['id'],$userID); //--basis for role, self
		$data['getRole'] 	= $this->users->getrole( $this->users->getpastor( $userData['id'] ),$userID); //--basis for role, highest, pastor
		
		if(empty($userData)){
			 
			 
			redirect(base_url());
			
		}else{
			//if(count($result) == 0){redirect('Welcome', 'refresh');}else{$this->load->view('welcome_message',$data);}
			
		}
		
		$data['Gender']	= $this->users->info($userID)->Gender;
		$data['progress'] = $this->users->getcounts();
		
		$data["upcomingevents"] = $this->events2->upcomingevents($userData['id']);
		$data["realUserID"] = $userData['id'];
		
		$this->load->view('headers/adminhead',$data);
		$this->load->view('edit',$data);
		$this->load->view('footers/adminfooter',$data);	
	
		
	
}